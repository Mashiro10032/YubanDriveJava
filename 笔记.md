# YubanDrive踩坑笔记

-----------------------

一、用户登录注册相关  
&ensp;&ensp;&ensp;（一）、通过“黑名单机制”实现用户退出、修改密码等操作后JWT强制失效  
                        1.首先JWT的有效期和Redis缓存有效期都必须一致，具体时间依照实际项目需求  
                        2.在用户退出、修改密码等操作后，将JWT添加到Redis缓存中   
                        3.每次请求都判断当前JWT是否在Redis缓存中，如果存在的话当前JWT就处于失效状态   
                        4.做双层判断，首先现在isAccessAllowed方法中判断，存在返回false的时候会进入到onAccessDenied方法再判断一次，存在则直接抛出一个Token过期的异常   
&ensp;&ensp;&ensp;（二）、使用JWT后不能再使用Shiro提供的subject.login()方法登录系统，而是在Controller层手动判断账号密码正确性后再直接签发JWT给前端   

二、文件管理模块

            文件存储路径为：项目根目录\files\用户名\

        （一）、文件上传

                        1.发送分片携带一下参数

                                



文件存储的实际逻辑

文件存储分实际IO操作和虚拟操作 虚拟操作只在数据库上实现

本地磁盘只做文件读写,用户上传的文件都统一存放到用户名命名的文件夹下

文件的复制 重命名 移动和文件夹的新建 复制 重命名 移动等操作都在数据库上实现

数据库表中有绝对路径和相对路径  绝对路径就是文件实际的存放路径 绝对路径则是虚拟的
